<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>È†ÜÂ∫èÈªû - Number Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
      background: radial-gradient(circle at top, #fdfbfb, #ebedee);
      font-size: 16px;
    }

    .game-container {
      background: #ffffff;
      padding: 22px 18px 18px;
      border-radius: 18px;
      box-shadow: 0 14px 35px rgba(15, 23, 42, 0.18);
      width: min(540px, 100%);
      position: relative;
      overflow: hidden;
    }

    /* ÊâãÊ©ü‰∏äËÆìÈÅäÊà≤ÂçÄÂüüÊõ¥Â§ß */
    @media (max-width: 600px) {
      body {
        align-items: stretch;
        padding: 0;
      }
      .game-container {
        width: 100%;
        min-height: 100vh;
        border-radius: 0;
        box-shadow: none;
        padding: 18px 12px 16px;
      }
      .title {
        font-size: 22px;
      }
      .cell {
        font-size: clamp(22px, 7vw, 30px);
      }
    }

    .game-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 12px;
    }

    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .subtitle {
      font-size: 13px;
      color: #64748b;
      white-space: nowrap;
    }

    .status-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
      font-size: 14px;
      color: #475569;
    }

    .status-label strong {
      color: #0f172a;
    }

    .badge {
      font-size: 12px;
      background: #e0f2fe;
      color: #0369a1;
      border-radius: 999px;
      padding: 4px 9px;
    }

    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
      font-size: 14px;
      color: #475569;
    }

    .controls label {
      white-space: nowrap;
    }

    .controls input {
      width: 70px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid #cbd5f5;
      outline: none;
      font-size: 14px;
    }

    .controls input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.2);
    }

    .controls button {
      margin-left: auto;
      border: none;
      border-radius: 999px;
      padding: 7px 16px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: #ffffff;
      box-shadow: 0 8px 15px rgba(37, 99, 235, 0.35);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        filter 0.12s ease;
    }

    .controls button:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow: 0 10px 22px rgba(37, 99, 235, 0.45);
    }

    .controls button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 5px 10px rgba(37, 99, 235, 0.35);
    }

    .grid-wrapper {
      position: relative;
    }

    .grid {
      display: grid;
      gap: 8px;
      margin-top: 6px;
      transition: transform 0.25s ease;
    }

    .cell {
      background: #eff6ff;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-weight: 700;
      font-size: 24px;
      color: #1d4ed8;
      user-select: none;
      box-shadow: 0 2px 0 rgba(15, 23, 42, 0.1);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.12s ease, color 0.12s ease;
      /* 5:4 ÊØî‰æã */
      aspect-ratio: 5 / 4;
      padding: 0;
    }

    .cell:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(15, 23, 42, 0.18);
      background: #dbeafe;
    }

    .cell:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.15);
    }

    .cell.correct {
      background: #22c55e;
      color: #f9fafb;
      box-shadow: 0 3px 10px rgba(34, 197, 94, 0.5);
      transform: scale(0.96);
    }

    .cell.disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .cell.disabled:hover,
    .cell.disabled:active {
      transform: none;
      box-shadow: none;
    }

    .message {
      margin-top: 10px;
      font-size: 14px;
      min-height: 20px;
      color: #94a3b8;
    }

    .message.error {
      color: #b91c1c;
    }

    .message.success {
      color: #15803d;
    }

    .back-link {
      margin-top: 6px;
      font-size: 13px;
    }

    .back-link a {
      color: #3b82f6;
      text-decoration: none;
    }

    .back-link a:hover {
      text-decoration: underline;
    }

    /* ÂÆåÊàêÂãïÁï´ */
    .completed .grid {
      animation: celebrate 0.9s ease-in-out;
    }

    @keyframes celebrate {
      0% {
        transform: scale(1);
      }
      30% {
        transform: scale(1.04) rotate(-1deg);
      }
      60% {
        transform: scale(1.04) rotate(1deg);
      }
      100% {
        transform: scale(1);
      }
    }

    .fireworks {
      pointer-events: none;
      position: absolute;
      inset: -10px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .fireworks-dot {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fbbf24;
      opacity: 0;
      animation: pop 0.8s ease-out forwards;
    }

    @keyframes pop {
      0% {
        transform: translate(0, 0) scale(0.4);
        opacity: 0;
      }
      20% {
        opacity: 1;
      }
      100% {
        transform: translate(var(--dx), var(--dy)) scale(1);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="game-container" id="gameContainer">
    <div class="game-header">
      <div class="title-row">
        <div class="title">È†ÜÂ∫èÈªû</div>
        <div class="subtitle">‰æùÂ∫è 1 ‚Üí 2 ‚Üí 3 ‚Ä¶ ÈªûÂÆåÂÖ®ÈÉ®</div>
      </div>
      <div class="status-row">
        <div class="status-label">
          ‰∏ã‰∏ÄÂÄãÊï∏Â≠óÔºö<strong id="nextNumberLabel">1</strong>
        </div>
        <div class="badge" id="statusBadge">ÈÄ≤Ë°å‰∏≠</div>
      </div>
    </div>

    <div class="controls">
      <label for="sizeInput">Â§ßÂ∞è n√ónÔºö</label>
      <input
        type="number"
        id="sizeInput"
        min="2"
        max="8"
        step="1"
        value="4"
      />
      <button id="resetBtn">ÂÜç‰∏ÄÊ¨°</button>
    </div>

    <div class="grid-wrapper">
      <div class="grid" id="grid"></div>
      <div class="fireworks" id="fireworks"></div>
    </div>

    <div class="message" id="message"></div>
    <div class="back-link"><a href="index.html">‚Üê ÂõûÈÅäÊà≤ÈÅ∏ÂñÆ</a></div>
  </div>

  <script>
    const gridEl = document.getElementById("grid");
    const nextNumberLabel = document.getElementById("nextNumberLabel");
    const statusBadge = document.getElementById("statusBadge");
    const messageEl = document.getElementById("message");
    const sizeInput = document.getElementById("sizeInput");
    const resetBtn = document.getElementById("resetBtn");
    const container = document.getElementById("gameContainer");
    const fireworksEl = document.getElementById("fireworks");

    let n = 4;
    let nextNumber = 1;
    let maxNumber = n * n;
    let completed = false;
    let audioCtx = null;

    function initAudio() {
      if (!audioCtx) {
        const AudioContext =
          window.AudioContext || window.webkitAudioContext || null;
        if (!AudioContext) return;
        audioCtx = new AudioContext();
      }
    }

    function playTone(freq, duration, type = "sine", volume = 0.2) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.value = freq;
      gain.gain.value = volume;
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      gain.gain.exponentialRampToValueAtTime(
        0.0001,
        audioCtx.currentTime + duration
      );
      osc.stop(audioCtx.currentTime + duration + 0.02);
    }

    function playSuccessSound(isFinal = false) {
      initAudio();
      if (!audioCtx) return;
      if (isFinal) {
        playTone(880, 0.12, "triangle", 0.25);
        setTimeout(() => playTone(1046.5, 0.18, "triangle", 0.25), 120);
      } else {
        playTone(740, 0.08, "triangle", 0.18);
      }
    }

    function playErrorSound() {
      initAudio();
      if (!audioCtx) return;
      playTone(220, 0.22, "square", 0.22);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function createGrid() {
      gridEl.innerHTML = "";
      fireworksEl.innerHTML = "";
      container.classList.remove("completed");

      const cells = [];
      for (let i = 1; i <= maxNumber; i++) {
        cells.push(i);
      }
      shuffle(cells);

      gridEl.style.gridTemplateColumns = `repeat(${n}, 1fr)`;

      cells.forEach((number) => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = number;
        cell.dataset.value = number;
        cell.addEventListener("click", onCellClick);
        gridEl.appendChild(cell);
      });

      nextNumberLabel.textContent = nextNumber;
      messageEl.textContent = "Ë´ã‰æùÂ∫èÈªûÊìä 1, 2, 3, ‚Ä¶";
      messageEl.className = "message";
      statusBadge.textContent = "ÈÄ≤Ë°å‰∏≠";
      statusBadge.style.background = "#e0f2fe";
      statusBadge.style.color = "#0369a1";
    }

    function onCellClick(e) {
      if (completed) return;
      const cell = e.currentTarget;
      const value = parseInt(cell.dataset.value, 10);

      if (value === nextNumber) {
        cell.classList.add("correct");
        playSuccessSound(nextNumber === maxNumber);

        if (nextNumber === maxNumber) {
          handleComplete();
        } else {
          nextNumber++;
          nextNumberLabel.textContent = nextNumber;
          messageEl.textContent = `‰∏çÈåØÔºÅ‰∏ã‰∏ÄÂÄãË´ãÈªû ${nextNumber}`;
          messageEl.className = "message";
        }
      } else {
        handleWrong();
      }
    }

    // ÈªûÈåØÔºöÂè™ÁôºÈåØË™§Èü≥ÊïàËàáÊèêÁ§∫Ôºå‰ΩÜÂèØ‰ª•ÁπºÁ∫åÁé©
    function handleWrong() {
      playErrorSound();
      messageEl.textContent = `ÈªûÈåØ‰∫ÜÔºÅ‰∏ã‰∏ÄÂÄãÊáâË©≤ÊòØ ${nextNumber} ÂñîÔΩû`;
      messageEl.className = "message error";
    }

    function handleComplete() {
      completed = true;
      statusBadge.textContent = "ÊåëÊà∞ÊàêÂäü";
      statusBadge.style.background = "#dcfce7";
      statusBadge.style.color = "#15803d";
      messageEl.textContent = "ÂÖ®ÈÉ®ÂÆåÊàêÔºÅÂ§™Âº∑‰∫Ü üéâ";
      messageEl.className = "message success";
      disableAllCells();
      showFireworks();
      container.classList.add("completed");
    }

    function disableAllCells() {
      document.querySelectorAll(".cell").forEach((c) => {
        c.classList.add("disabled");
      });
    }

    function showFireworks() {
      fireworksEl.innerHTML = "";
      const dots = 26;
      for (let i = 0; i < dots; i++) {
        const dot = document.createElement("div");
        dot.className = "fireworks-dot";
        const angle = (Math.PI * 2 * i) / dots;
        const radius = 60 + Math.random() * 40;
        const dx = Math.cos(angle) * radius;
        const dy = Math.sin(angle) * radius;
        dot.style.setProperty("--dx", dx + "px");
        dot.style.setProperty("--dy", dy + "px");
        fireworksEl.appendChild(dot);
      }
      setTimeout(() => {
        fireworksEl.innerHTML = "";
      }, 900);
    }

    function resetGame() {
      let inputN = parseInt(sizeInput.value, 10);
      if (isNaN(inputN) || inputN < 2) inputN = 2;
      if (inputN > 8) inputN = 8;
      sizeInput.value = inputN;

      n = inputN;
      maxNumber = n * n;
      nextNumber = 1;
      completed = false;

      createGrid();
    }

    resetBtn.addEventListener("click", resetGame);
    sizeInput.addEventListener("change", resetGame);

    window.addEventListener(
      "pointerdown",
      () => {
        initAudio();
      },
      { once: true }
    );

    resetGame();
  </script>
</body>
</html>
